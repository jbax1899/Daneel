# Discord bot credentials (required)
DISCORD_TOKEN= # Discord bot token
DISCORD_CLIENT_ID= # Discord application client ID
DISCORD_GUILD_ID= # Discord server (guild) ID
DISCORD_USER_ID= # Discord user ID granted privileged access (owner-only actions, rate-limit bypass)
OPENAI_API_KEY=

# Logging verbosity (debug, info, warn, error)
LOG_LEVEL=debug

# HMAC secret for pseudonymizing Discord identifiers 
# Generate with: node -e "console.log(require('node:crypto').randomBytes(32).toString('hex'))"
INCIDENT_PSEUDONYMIZATION_SECRET=

# Optional prompt configuration overrides
# Provide a path to a YAML file (copy packages/backend/src/shared/prompts/defaults.yaml) to tweak prompts without redeploying.
PROMPT_CONFIG_PATH=

# Optional rate limiting overrides
RATE_LIMIT_USER=true
USER_RATE_LIMIT=5
USER_RATE_WINDOW_MS=60000
RATE_LIMIT_CHANNEL=true
CHANNEL_RATE_LIMIT=10
CHANNEL_RATE_WINDOW_MS=60000
RATE_LIMIT_GUILD=true
GUILD_RATE_LIMIT=20
GUILD_RATE_WINDOW_MS=60000

# Optional web API rate limiting configuration
# These limits are stricter than Discord limits to prevent abuse of the public web endpoint
WEB_API_RATE_LIMIT_IP=3 # Maximum requests per IP per time window (default: 3)
WEB_API_RATE_LIMIT_IP_WINDOW_MS=60000 # Time window for IP rate limiting in milliseconds (default: 60000)
WEB_API_RATE_LIMIT_SESSION=5 # Maximum requests per session per time window (default: 5)
WEB_API_RATE_LIMIT_SESSION_WINDOW_MS=60000 # Time window for session rate limiting in milliseconds (default: 60000)

# Cloudflare Turnstile CAPTCHA configuration (optional for web reflect API)
# Get these from https://dash.cloudflare.com/profile/api-tokens
# Public site key is served to the web app via /config.json (requires secret key to enable)
TURNSTILE_SITE_KEY=
TURNSTILE_SECRET_KEY= # Secret key for server-side verification (never expose publicly)

# Optional thread engagement controls
ALLOW_THREAD_RESPONSES=true # Set false to block replies in all threads unless in whitelist (ALLOWED_THREAD_IDS)
ALLOWED_THREAD_IDS= # Comma-separated thread IDs that stay enabled when thread replies are disabled

# Optional image generation overrides
IMAGE_DEFAULT_TEXT_MODEL=gpt-5-mini
IMAGE_DEFAULT_IMAGE_MODEL=gpt-image-1-mini
IMAGE_DEFAULT_QUALITY=low
IMAGE_DEFAULT_OUTPUT_FORMAT=webp
IMAGE_DEFAULT_OUTPUT_COMPRESSION=80
IMAGE_TOKENS_PER_REFRESH=10
IMAGE_TOKEN_REFRESH_INTERVAL_MS=86400000
# Provide a JSON map for convenience when tweaking several models at once
IMAGE_MODEL_MULTIPLIERS={"gpt-image-1":2,"gpt-image-1-mini":1}
# Or override individual models by replacing hyphens with underscores
IMAGE_MODEL_MULTIPLIER_GPT_IMAGE_1=2
IMAGE_MODEL_MULTIPLIER_GPT_IMAGE_1_MINI=1

# Optional channel context manager configuration
# Enable in-memory per-channel state tracking for engagement decisions and cost monitoring
CONTEXT_MANAGER_ENABLED=true # Enables rolling message buffers and metrics
CONTEXT_MANAGER_MAX_MESSAGES=50 # Number of recent messages to keep per channel
CONTEXT_MANAGER_RETENTION_MS=3600000 # How long to keep messages (1 hour = 3600000ms)
CONTEXT_MANAGER_EVICTION_INTERVAL_MS=300000 # Cleanup frequency (5 minutes = 300000ms)

# Optional LLM cost tracking configuration (Phase 3 - Realtime Engagement)
# Enable precise tracking of OpenAI API usage and costs per channel/guild/global
COST_ESTIMATOR_ENABLED=true # Set false to disable cost tracking and logging

# Optional realtime engagement filter configuration (Phase 4 - Realtime Engagement)
# Enable context-aware engagement scoring to replace simple counter-based catchup
REALTIME_FILTER_ENABLED=false # Set true to enable weighted engagement scoring

# Engagement scoring weights (0-1 range, higher = more influence)
ENGAGEMENT_WEIGHT_MENTION=0.3 # Direct mentions and replies
ENGAGEMENT_WEIGHT_QUESTION=0.2 # Question marks and interrogatives
ENGAGEMENT_WEIGHT_TECHNICAL=0.15 # Technical keywords
ENGAGEMENT_WEIGHT_HUMAN_ACTIVITY=0.15 # Recent human message ratio
ENGAGEMENT_WEIGHT_COST_SATURATION=0.1 # Cost velocity (negative signal)
ENGAGEMENT_WEIGHT_BOT_NOISE=0.05 # Bot message ratio (negative signal)
ENGAGEMENT_WEIGHT_DM_BOOST=1.5 # Multiplier for DM contexts
ENGAGEMENT_WEIGHT_DECAY=0.05 # Time decay factor

# Engagement behavior preferences
ENGAGEMENT_IGNORE_MODE=silent # How to acknowledge when skipping: 'silent' or 'react'
ENGAGEMENT_REACTION_EMOJI=ðŸ‘€ # Emoji to use when ignoreMode=react
ENGAGEMENT_MIN_THRESHOLD=0.5 # Minimum score to engage (0-1)
ENGAGEMENT_PROBABILISTIC_LOW=0.4 # Lower bound of grey zone for LLM refinement
ENGAGEMENT_PROBABILISTIC_HIGH=0.6 # Upper bound of grey zone for LLM refinement
ENGAGEMENT_ENABLE_LLM_REFINEMENT=false # Use LLM to refine scores in grey zone

# Optional web server configuration
WEB_BASE_URL= # Base URL for the web server that hosts trace pages (required unless deploying with Fly.io)
BACKEND_BASE_URL= # Base URL for backend API (e.g. http://localhost:3000 for local dev)
ARETE_ALLOWED_ORIGINS=http://localhost:8080,http://localhost:3000 # Comma-separated CORS allowlist
ARETE_FRAME_ANCESTORS=http://localhost:8080,http://localhost:3000 # Comma-separated CSP frame-ancestors allowlist
ARETE_DEFAULT_MODEL=gpt-5-mini # Default model for reflect responses
ARETE_DEFAULT_REASONING_EFFORT=low
ARETE_DEFAULT_VERBOSITY=low
TRACE_API_TOKEN= # Shared secret required for POST /api/traces (generate with: node -e "console.log(require('node:crypto').randomBytes(32).toString('hex'))")
TRACE_API_RATE_LIMIT=10 # Max trace writes per IP per window
TRACE_API_RATE_LIMIT_WINDOW_MS=60000
TRACE_API_MAX_BODY_BYTES=200000
REFLECT_API_MAX_BODY_BYTES=20000 # Max POST body size for /api/reflect

# Optional Cloudinary configuration (image uploads)
# If unset, image responses fall back to Discord attachments.
CLOUDINARY_CLOUD_NAME=
CLOUDINARY_API_KEY=
CLOUDINARY_API_SECRET=

# GitHub webhook configuration for blog integration (optional; enables blog sync)
GITHUB_WEBHOOK_SECRET= # The secret configured in GitHub repository webhook settings, used to verify webhook signatures from GitHub Discussions

# SQLite database path
# On Fly.io, /data is backed by a persistent volume (see deploy/fly.backend.toml)
# For bare metal or other deployments, use any persistent path
PROVENANCE_SQLITE_PATH=/data/provenance.db
